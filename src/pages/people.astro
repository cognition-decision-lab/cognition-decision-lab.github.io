---
import Layout from '../layouts/Layout.astro'
import people from '../data/people.json'

const toOptimized = (path: string) => {
  const dot = path.lastIndexOf('.')
  if (dot === -1) return { avif: path, webp: path, jpg: path }
  const base = path.slice(0, dot)
  return {
    avif: `${base}-400.avif`,
    webp: `${base}-400.webp`,
    jpg: `${base}-400.jpg`,
  }
}
---
<Layout>
  <section class="py-12">
    <h1 class="text-4xl font-bold mb-8">People</h1>
    <div class="space-y-12">
      <!-- Affiliated Faculty -->
      <h2 class="text-2xl font-bold mb-4">Affiliated Faculty</h2>
      <div class="grid md:grid-cols-3 gap-8">
        {people.faculty.map(faculty => (
          <div class="flex flex-col" key={faculty.name}>
            {(() => { const opt = toOptimized(faculty.image); return (
              <picture class="mb-4 mx-auto">
                <source srcset={opt.avif} type="image/avif" />
                <source srcset={opt.webp} type="image/webp" />
                <img src={faculty.image} alt={faculty.name} class="profile-square" loading="lazy" decoding="async" width="160" height="160" />
              </picture>
            ); })()}
            <h3 class="text-xl font-semibold text-center">{faculty.name}</h3>
            <p>{faculty.title}</p>
            <p class="text-sm mt-2" style="text-align: justify; word-break: break-word; hyphens: auto;">Areas of Interest: {faculty.areas}</p>
            <div class="mt-2 flex flex-col gap-1">
              <a href={faculty.website} class="text-blue-600 underline">Website</a>
              <a href={`mailto:${faculty.email}`} class="text-blue-600 underline">{faculty.email}</a>
            </div>
          </div>
        ))}
      </div>
      <!-- Affiliated Researchers -->
      <h2 class="text-2xl font-bold mt-12 mb-4">Affiliated Researchers</h2>
      <div class="grid md:grid-cols-3 gap-8">
        {people.researchers.map(researcher => (
          <div class="flex flex-col" key={researcher.name}>
            {(() => { const opt = toOptimized(researcher.image); return (
              <picture class="mb-4">
                <source srcset={opt.avif} type="image/avif" />
                <source srcset={opt.webp} type="image/webp" />
                <img src={researcher.image} alt={researcher.name} class="profile-square" loading="lazy" decoding="async" width="160" height="160" />
              </picture>
            ); })()}
            <h3 class="text-lg font-semibold">{researcher.name}</h3>
            <p>{researcher.title}</p>
            <div class="mt-2 flex flex-col gap-1">
              {researcher.website && <a href={researcher.website} class="text-blue-600 underline">Website</a>}
              {researcher.linkedin && <a href={researcher.linkedin} class="text-blue-600 underline">LinkedIn</a>}
              <a href={`mailto:${researcher.email}`} class="text-blue-600 underline">{researcher.email}</a>
            </div>
          </div>
        ))}
      </div>
      <!-- Ph.D. Students -->
      <h2 class="text-2xl font-bold mt-12 mb-4">Ph.D. Students</h2>
      <div class="grid md:grid-cols-3 gap-8">
        {people.students.map(student => (
          <div class="flex flex-col" key={student.name}>
            {(() => { const opt = toOptimized(student.image); return (
              <picture class="mb-4">
                <source srcset={opt.avif} type="image/avif" />
                <source srcset={opt.webp} type="image/webp" />
                <img src={student.image} alt={student.name} class="profile-square" loading="lazy" decoding="async" width="160" height="160" />
              </picture>
            ); })()}
            <h3 class="text-lg font-semibold">{student.name}</h3>
            <p>{student.title}</p>
            <a href={`mailto:${student.email}`} class="text-blue-600 underline mt-2">{student.email}</a>
          </div>
        ))}
      </div>
      <!-- Alumni -->
      <h2 class="text-2xl font-bold mt-12 mb-4">Alumni</h2>
      <div class="space-y-4">
        <h3 class="text-lg font-semibold">Former Post Doctoral Research Scholars</h3>
        <ul class="list-disc ml-8">
          {people.alumni.postdocs.map((item, idx) => <li key={idx}>{item}</li>)}
        </ul>
        <h3 class="text-lg font-semibold mt-4">Former Ph.D. Students</h3>
        <ul class="list-disc ml-8">
          {people.alumni.phds.map((item, idx) => <li key={idx}>{item}</li>)}
        </ul>
        <h3 class="text-lg font-semibold mt-4">Former Undergraduate Students</h3>
        <ul class="list-disc ml-8">
          {people.alumni.undergrads.map((item, idx) => <li key={idx}>{item}</li>)}
        </ul>
      </div>
    </div>
  </section>
</Layout>
